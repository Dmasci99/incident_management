<%/**
 * Anthony Scinocco 200271982
 * November 30, 2015
 * incident-management.azurewebsite.net
 * Contains the view for our ticket dashboard
 *
 * */%>
<%- include ../partials/header.ejs %>


<section>
    <div class="container">
        <div class="table-responsive">
            <table class="table-bordered">
                <thead>
                    <tr>
                        <th>Ticket Reference ID</th>
                        <th>Ticket Owner</th>
                        <th>Title</th>
                        <th>Severity</th>
                        <th>Status</th>
                        <th>Opened On</th>
                        <th>Update</th>
                    </tr>
                </thead>
                <tbody>
                <% if (filter == 'all') { /**Display all open and closed tickets*/%>
                <% for(var i = 0; i < tickets.length; i++) { %>
                    <tr>
                        <td><%= tickets[i].referenceId %></td>
                        <td><%= tickets[i].username %></td>
                        <td><%= tickets[i].title %></td>
                        <td>
                            <% if (tickets[i].severity <= 15) { %>
                                Green
                            <% } else if(tickets[i].severity >= 16 && tickets[i].severity <= 30) { %>
                                Yellow
                            <% } else if (tickets[i].severity >= 31 && tickets[i].severity <= 45) { %>
                                Red
                            <% } %>
                        </td>
                        <td><%= tickets[i].status %></td>
                        <td><%= tickets[i].createdAt %></td>
                        <td><a href="/incident/update/<%= tickets[i]._id %>" title="Update" class="btn btn-primary">Update</a></td>
                    </tr>
                <% }/**close for loop*/ %>
                <% } else if(filter == 'open') { %>
                <% for(var i = 0; i < tickets.length; i++) { %>
                    <!--display all tickets that are not closed-->
                    <% if(tickets[i].status == 'Open' || tickets[i].status == 'Assigned' || tickets[i].status == 'In Progress' ||
                          tickets[i].status == 'Pending' || tickets[i].status == 'Resolved') { %>
                    <tr>
                        <td><%= tickets[i].referenceId %></td>
                        <td><%= tickets[i].username %></td>
                        <td><%= tickets[i].title %></td>
                        <td>
                            <% if (tickets[i].severity <= 15) { %>
                            Green
                            <% } else if(tickets[i].severity >= 16 && tickets[i].severity <= 30) { %>
                            Yellow
                            <% } else if (tickets[i].severity >= 31 && tickets[i].severity <= 45) { %>
                            Red
                            <% } %>
                        </td>
                        <td><%= tickets[i].status %></td>
                        <td><%= tickets[i].createdAt %></td>
                        <td><a href="/incident/update/<%= tickets[i]._id %>" title="Update" class="btn btn-primary">Update</a></td>
                    </tr>
                    <% } /**end nested if*/%>
                <% }/**close for loop*/ %>
                <% } else if(filter == 'closed') { %>
                <% for(var i = 0; i < tickets.length; i++) { %>
                <!--display all tickets that are not closed-->
                <% if(tickets[i].status == 'Closed') { %>
                <tr>
                    <td><%= tickets[i].referenceId %></td>
                    <td><%= tickets[i].username %></td>
                    <td><%= tickets[i].title %></td>
                    <td>
                        <% if (tickets[i].severity <= 15) { %>
                        Green
                        <% } else if(tickets[i].severity >= 16 && tickets[i].severity <= 30) { %>
                        Yellow
                        <% } else if (tickets[i].severity >= 31 && tickets[i].severity <= 45) { %>
                        Red
                        <% } %>
                    </td>
                    <td><%= tickets[i].status %></td>
                    <td><%= tickets[i].createdAt %></td>
                    <td><a href="/incident/update/<%= tickets[i]._id %>" title="Update" class="btn btn-primary">Update</a></td>
                </tr>
                <% } /**end nested if*/%>
                <% }/**close for loop*/ %>
                <% } %>
                </tbody>
            </table>
            <a href="/incident/add/" title="Add a ticket" class="btn btn-primary">Add Ticket</a>
            <a href="/incident/filter/open" title="View Open Tickets" class="btn btn-primary">View Open Tickets</a>
            <a href="/incident/filter/closed" title="View Closed Tickets" class="btn btn-primary">View Closed Tickets</a>
            <a href="/incident/filter/all" title="View All Tickets" class="btn btn-primary">View All Tickets</a>
        </div>

       <!-- <form method="post" action="/incident/filterDashboard/">
            <div class="checkbox">
                <input type="checkbox" name="all" id="all"> View all tickets(Including Closed Tickets)?
            </div>
            <button type="submit" class="btn btn-primary">Filter Dashboard</button>
        </form>-->
    </div>
</section>

<!-- This is our Ticket "Dashboard" where appropriate tickets will be displayed
in list/table format. Only a portion of the information will be displayed. Click
a ticket in order to go to single.ejs view -->

<!-- Client users will only be able to see their own tickets; 
whereas Admin users will be able to see ALL user tickets ... correct? -->

<%- include ../partials/footer.ejs %>
